!function(o){o.fn.nodoubletapzoom=function(){o(this).bind("touchstart",function(t){var e=t.timeStamp,i=o(this).data("lastTouch")||e,n=e-i,r=t.originalEvent.touches.length;o(this).data("lastTouch",e),!n||n>500||r>1||(t.preventDefault(),o(this).trigger("click").trigger("click"))})}}(jQuery),function(o,t,e){Croppic=function(o,t){var i=this;i.id=o,i.obj=e("#"+o),i.outputDiv=i.obj,i.options={uploadUrl:"",uploadData:{},cropUrl:"",cropData:{},outputUrlId:"",generatedImageFormat:"jpeg",generatedImageQuality:80,imgEyecandy:!0,imgEyecandyOpacity:.2,imgOverlay:!1,imgOverlayOpacity:1,zoomFactor:10,rotateFactor:5,doubleZoomControls:!0,rotateControls:!0,undoControl:!0,modal:!1,customUploadButtonId:"",loaderHtml:"",scaleToFill:!0,allowUpscaleBeyondCropSize:!1,processInline:!1,processInlineFallback:!1,loadPicture:"",enableMousescroll:!1,inForm:!1,fileInputName:"img",croppedImage:"",validTypes:["jpg","png","gif"],onBeforeImgUpload:null,onAfterImgUpload:null,onImgDrag:null,onImgZoom:null,onImgRotate:null,onBeforeImgCrop:null,onAfterImgCrop:null,onBeforeRemoveCroppedImg:null,onAfterRemoveCroppedImg:null,onError:null,onBeforeReset:null,onReset:null,addExtraUploadControls:!1};for(var n in t)i.options[n]=t[n];i.init()},Croppic.prototype={id:"",imgInitW:0,imgInitH:0,imgW:0,imgH:0,objW:0,objH:0,actualRotation:0,windowW:0,windowH:e(o).height(),obj:{},outputDiv:{},outputUrlObj:{},img:{},defaultImg:{},croppedImg:{},imgEyecandy:{},imgOverlay:{},form:{},iframeform:{},iframeobj:{},iframeFileInput:{},cropControlsUpload:{},cropControlsCrop:{},cropControlZoomMuchIn:{},cropControlZoomMuchOut:{},cropControlZoomIn:{},cropControlZoomOut:{},cropControlRotateLeft:{},cropControlRotateRight:{},cropControlCrop:{},cropControlReset:{},cropControlRemoveCroppedImage:{},cropControlUndoCrop:{},modal:{},loader:{},originalImage:!1,fileValidRegex:void 0,init:function(){var o=this;o.objW=o.obj.width(),o.objH=o.obj.height(),o.actualRotation=0,e.isEmptyObject(o.defaultImg)&&(o.defaultImg=o.obj.find("img")),o.options.croppedImage&&(o.obj.append('<img class="croppedImg" src="'+o.options.croppedImage+'">'),""!==o.options.outputUrlId&&e("#"+o.options.outputUrlId).val(o.options.croppedImage),o.croppedImg=o.obj.find(".croppedImg"),o.options.croppedImage=""),o.createImgUploadControls(),""===o.options.loadPicture?o.bindImgUploadControl():o.loadExistingImage()},createImgUploadControls:function(){var o=this,t="";""===o.options.customUploadButtonId&&(t='<i class="cropControlUpload" title="Upload picture"></i>');var i='<i class="cropControlRemoveCroppedImage" title="Discard crop"></i>',n=o.options.undoControl&&o.originalImage?'<i class="cropControlUndoCrop" title="Undo crop"></i>':"";e.isEmptyObject(o.croppedImg)&&(i=""),""!==o.options.loadPicture&&(t="");var r='<div class="cropControls cropControlsUpload"> '+t+n+i+" </div>";o.outputDiv.append(r),o.cropControlsUpload=o.outputDiv.find(".cropControlsUpload"),""===o.options.customUploadButtonId?o.imgUploadControl=o.outputDiv.find(".cropControlUpload"):(o.imgUploadControl=e("#"+o.options.customUploadButtonId),o.imgUploadControl.show()),e.isEmptyObject(o.croppedImg)||(o.cropControlRemoveCroppedImage=o.outputDiv.find(".cropControlRemoveCroppedImage")),o.options.undoControl&&o.originalImage&&(o.cropControlUndoCrop=o.outputDiv.find(".cropControlUndoCrop")),o.options.addExtraUploadControls&&t&&o.options.addExtraUploadControls.call(o,o.cropControlsUpload)},bindImgUploadControl:function(){var o=this;if(e.isEmptyObject(o.form)){if(o.options.inForm)o.form=o.outputDiv.closest("form");else{var i='<form class="'+o.id+'_imgUploadForm" style="visibility: hidden;">  <input type="file" name="'+o.options.fileInputName+'" id="'+o.id+'_imgUploadField">  </form>';o.outputDiv.append(i),o.form=o.outputDiv.find("."+o.id+"_imgUploadForm")}o.fileField=o.form.find('input[type="file"]'),o.fileField.change(function(){if(o.isFileValid(o.fileField[0])){if(o.options.onBeforeImgUpload&&o.options.onBeforeImgUpload.call(o),o.showLoader(),o.cropControlsUpload.hide(),o.options.processInline&&!o.options.processInlineFallback&&!Croppic.isProcessInlineSupported)return o.options.onError&&o.options.onError.call(o,"processInline is not supported by your Browser"),void o.reset();if(o.options.processInline){var i=new FileReader,n=function(t){o.imgInitW=o.imgW=t.width,o.imgInitH=o.imgH=t.height,o.options.modal&&o.createModal(),e.isEmptyObject(o.croppedImg)||(o.croppedImg.remove(),o.croppedImg={}),o.imgUrl=t.src,o.obj.append('<img src="'+t.src+'">'),o.initCropper(),o.hideLoader(),o.options.onAfterImgUpload&&o.options.onAfterImgUpload.call(o)};i.onload=function(o){var e=new Image;e.onload=function(){if(void 0===EXIF)n(e);else{var o=EXIF.getData(e,function(){var o=EXIF.getTag(this,"Orientation");if(o>1){var i=t.createElement("canvas"),r=i.getContext&&i.getContext("2d");if(r){var a=0;switch(o){case 3:case 4:i.width=e.width,i.height=e.height,a=180;break;case 5:case 6:i.width=e.height,i.height=e.width,a=90;break;case 7:case 8:i.width=e.height,i.height=e.width,a=270}r.save(),r.translate(i.width/2,i.height/2),r.rotate(a*Math.PI/180),r.drawImage(e,-e.width/2,-e.height/2),r.restore();var p=new Image;return p.onload=function(){n(p)},void(p.src=i.toDataURL("image/jpeg",1))}}n(e)});o||n(e)}},e.src=o.target.result},i.readAsDataURL(o.fileField[0].files[0])}else{var r;try{r=new FormData(o.form[0])}catch(a){r=new FormData,r.append(o.options.fileInputName,o.fileField[0].files[0])}for(var p in o.options.uploadData)o.options.uploadData.hasOwnProperty(p)&&r.append(p,o.options.uploadData[p]);e.ajax({url:o.options.uploadUrl,data:r,context:t.body,cache:!1,contentType:!1,processData:!1,type:"POST"}).always(function(t){o.afterUpload(t)})}}})}var n=o.CreateFallbackIframe();o.imgUploadControl.off("click"),o.imgUploadControl.on("click",function(){""===n?(o.resetFileField(o.fileField),o.fileField.trigger("click")):(o.resetFileField(o.iframeFileInput),o.iframeFileInput.trigger("click"))}),e.isEmptyObject(o.croppedImg)||o.cropControlRemoveCroppedImage.on("click",function(){typeof o.options.onBeforeRemoveCroppedImg==typeof Function&&o.options.onBeforeRemoveCroppedImg.call(o),o.croppedImg.remove(),o.croppedImg={},e(this).hide(),typeof o.options.onAfterRemoveCroppedImg==typeof Function&&o.options.onAfterRemoveCroppedImg.call(o),e.isEmptyObject(o.defaultImg)||o.obj.append(o.defaultImg),""!==o.options.outputUrlId&&e("#"+o.options.outputUrlId).val("")}),o.options.undoControl&&o.originalImage&&o.cropControlUndoCrop.on("click",function(){var t=o.originalImage;o.originalImage=!1,o.loadPicture(t)})},resetFileField:function(o){o.val(""),o.val()&&(o.wrap("<form>").closest("form")[0].reset(),o.unwrap())},isFileValid:function(o){var t,i=this;if(void 0===i.fileValidRegex){i.fileInvalidMessage="Please select a ";var n,r;r=i.options.processInline&&Croppic.isProcessInlineSupported?["png","jpg","gif"]:i.options.validTypes,n=void 0===o.files?"\\.(":"^image/(";var a;e.each(r,function(t,e){e=e.toLowerCase(),"jpg"==e&&(void 0===o.files?e+="|jpeg":e="jpeg"),t&&(n+="|"),n+=e,a=t}),e.each(r,function(o,t){t=t.toLowerCase(),o&&(o==a?i.fileInvalidMessage+=" or ":i.fileInvalidMessage+=", "),i.fileInvalidMessage+=t}),n+=")$",i.fileInvalidMessage+=" image.",i.fileValidRegex=new RegExp(n,"i")}if(void 0===o.files)t=o.value;else{if(!o.files.length)return!1;t=o.files[0].type}var p=i.fileValidRegex.test(t);return p||alert(i.fileInvalidMessage),p},loadExistingImage:function(){var o=this;if(e.isEmptyObject(o.croppedImg)){o.options.onBeforeImgUpload&&o.options.onBeforeImgUpload.call(o),o.showLoader(),o.options.modal&&o.createModal(),o.imgUrl=o.options.loadPicture;var t=e('<img src="'+o.options.loadPicture+'">');o.obj.append(t),t.load(function(){o.imgInitW=o.imgW=this.width,o.imgInitH=o.imgH=this.height,o.initCropper(),o.hideLoader(),o.options.onAfterImgUpload&&o.options.onAfterImgUpload.call(o)})}else o.cropControlRemoveCroppedImage.on("click",function(){o.croppedImg.remove(),o.croppedImg={},e(this).hide(),e.isEmptyObject(o.defaultImg)||o.obj.append(o.defaultImg),""!==o.options.outputUrlId&&e("#"+o.options.outputUrlId).val(""),o.reset()})},afterUpload:function(o){var t=this,i="object"==typeof o?o:e.parseJSON(o);if("success"==i.status){t.imgInitW=t.imgW=i.width,t.imgInitH=t.imgH=i.height,t.options.inForm&&t.resetFileField(t.fileField),t.options.modal&&t.createModal(),e.isEmptyObject(t.croppedImg)||t.croppedImg.remove(),t.imgUrl=i.url;var n=e('<img src="'+i.url+'">');n.load(function(){t.initCropper(),t.hideLoader(),t.options.onAfterImgUpload&&t.options.onAfterImgUpload.call(t)}),t.obj.append(n)}"error"==i.status&&(alert(i.message),t.options.onError&&t.options.onError.call(t,i.message),t.hideLoader(),setTimeout(function(){t.reset()},2e3))},createModal:function(){var o=this,t=o.windowH/2-o.objH/2,i='<div id="croppicModal"><div id="croppicModalObj" style="width:'+o.objW+"px; height:"+o.objH+"px; margin:0 auto; margin-top:"+t+'px; position: relative;"> </div></div>';e("body").append(i),o.modal=e("#croppicModal"),o.obj=e("#croppicModalObj")},destroyModal:function(){var o=this;o.obj=o.outputDiv,o.modal.remove(),o.modal={}},initCropper:function(){var o=this;o.img=o.obj.find("img"),o.img.wrap('<div class="cropImgWrapper" style="overflow:hidden; z-index:1; position:absolute; width:'+o.objW+"px; height:"+o.objH+'px;"></div>'),o.createCropControls(),o.options.imgEyecandy&&o.createEyecandy(),o.options.imgOverlay&&o.createOverlay(),o.initDrag(),o.initialScaleImg()},createEyecandy:function(){var o=this;o.imgEyecandy=o.img.clone(),o.imgEyecandy.css({"z-index":"0",opacity:o.options.imgEyecandyOpacity}).addClass("test").appendTo(o.obj)},destroyEyecandy:function(){var o=this;o.imgEyecandy.remove()},createOverlay:function(){var o=this;o.imgOverlay=e(o.options.imgOverlay),o.imgOverlay.css({"z-index":2,opacity:o.options.imgOverlayOpacity,top:0,left:0,position:"absolute"}).addClass("overlay").appendTo(o.obj)},destroyOverlay:function(){var o=this;o.imgOverlay.remove()},initialScaleImg:function(){var o=this;o.zoom(-o.imgInitW),o.zoom(40),o.options.enableMousescroll&&o.img.on("mousewheel",function(t){t.preventDefault(),o.zoom(o.options.zoomFactor*t.deltaY)}),o.img.css({left:-(o.imgW-o.objW)/2,top:-(o.imgH-o.objH)/2,position:"relative"}),o.options.imgEyecandy&&o.imgEyecandy.css({left:-(o.imgW-o.objW)/2,top:-(o.imgH-o.objH)/2,position:"relative"})},createCropControls:function(){var o,t=this,e="",i='<i class="cropControlZoomIn" title="Zoom in, small"></i>',n='<i class="cropControlZoomOut" title="Zoom out, small"></i>',r="",a="",p="",l='<i class="cropControlCrop" title="Crop"></i>',s='<i class="cropControlReset" title="Discard image"></i>';t.options.doubleZoomControls&&(e='<i class="cropControlZoomMuchIn" title="Zoom in, large"></i>',r='<i class="cropControlZoomMuchOut" title="Zoom out, large"></i>'),t.options.rotateControls&&(a='<i class="cropControlRotateLeft" title="Rotate left"></i>',p='<i class="cropControlRotateRight" title="Rotate right"></i>'),o='<div class="cropControls cropControlsCrop">'+e+i+n+r+a+p+l+s+"</div>",t.obj.append(o),t.cropControlsCrop=t.obj.find(".cropControlsCrop"),t.options.doubleZoomControls&&(t.cropControlZoomMuchIn=t.cropControlsCrop.find(".cropControlZoomMuchIn"),t.cropControlZoomMuchIn.nodoubletapzoom(),t.cropControlZoomMuchIn.on("click",function(){t.zoom(10*t.options.zoomFactor)}),t.cropControlZoomMuchOut=t.cropControlsCrop.find(".cropControlZoomMuchOut"),t.cropControlZoomMuchOut.nodoubletapzoom(),t.cropControlZoomMuchOut.on("click",function(){t.zoom(10*-t.options.zoomFactor)})),t.cropControlZoomIn=t.cropControlsCrop.find(".cropControlZoomIn"),t.cropControlZoomIn.nodoubletapzoom(),t.cropControlZoomIn.on("click",function(){t.zoom(t.options.zoomFactor)}),t.cropControlZoomOut=t.cropControlsCrop.find(".cropControlZoomOut"),t.cropControlZoomOut.nodoubletapzoom(),t.cropControlZoomOut.on("click",function(){t.zoom(-t.options.zoomFactor)}),t.cropControlRotateLeft=t.cropControlsCrop.find(".cropControlRotateLeft"),t.cropControlRotateLeft.on("click",function(){t.rotate(-t.options.rotateFactor)}),t.cropControlRotateRight=t.cropControlsCrop.find(".cropControlRotateRight"),t.cropControlRotateRight.on("click",function(){t.rotate(t.options.rotateFactor)}),t.cropControlCrop=t.cropControlsCrop.find(".cropControlCrop"),t.cropControlCrop.on("click",function(){t.crop()}),t.cropControlReset=t.cropControlsCrop.find(".cropControlReset"),t.cropControlReset.on("click",function(){t.reset()})},initDrag:function(){var t=this,i=t.options.imgOverlay?t.imgOverlay:t.img;i.on("mousedown touchstart",function(n){n.preventDefault();var r,a,p=o.navigator.userAgent;p.match(/iPad/i)||p.match(/iPhone/i)||p.match(/android/i)||void 0===(n.pageY&&n.pageX)?(r=n.originalEvent.touches[0].pageX,a=n.originalEvent.touches[0].pageY):(r=n.pageX,a=n.pageY);var l=i.css("z-index"),s=t.img.outerHeight(),c=t.img.outerWidth(),d=t.img.offset().top+s-a,m=t.img.offset().left+c-r;i.css("z-index",1e3).on("mousemove touchmove",function(o){var n,r,a,g;p.match(/iPad/i)||p.match(/iPhone/i)||p.match(/android/i)||void 0===(o.pageY&&o.pageX)?(n=o.originalEvent.touches[0].pageY+d-s,r=o.originalEvent.touches[0].pageX+m-c):(n=o.pageY+d-s,r=o.pageX+m-c),t.img.offset({top:n,left:r}),i.on("mouseup",function(){e(this).removeClass("draggable").css("z-index",l)}),t.options.imgEyecandy&&t.imgEyecandy.offset({top:n,left:r}),t.objH<t.imgH?(parseInt(t.img.css("top"))>0&&(t.img.css("top",0),t.options.imgEyecandy&&t.imgEyecandy.css("top",0)),a=-(t.imgH-t.objH),parseInt(t.img.css("top"))<a&&(t.img.css("top",a),t.options.imgEyecandy&&t.imgEyecandy.css("top",a))):(parseInt(t.img.css("top"))<0&&(t.img.css("top",0),t.options.imgEyecandy&&t.imgEyecandy.css("top",0)),a=t.objH-t.imgH,parseInt(t.img.css("top"))>a&&(t.img.css("top",a),t.options.imgEyecandy&&t.imgEyecandy.css("top",a))),t.objW<t.imgW?(parseInt(t.img.css("left"))>0&&(t.img.css("left",0),t.options.imgEyecandy&&t.imgEyecandy.css("left",0)),g=-(t.imgW-t.objW),parseInt(t.img.css("left"))<g&&(t.img.css("left",g),t.options.imgEyecandy&&t.imgEyecandy.css("left",g))):(parseInt(t.img.css("left"))<0&&(t.img.css("left",0),t.options.imgEyecandy&&t.imgEyecandy.css("left",0)),g=t.objW-t.imgW,parseInt(t.img.css("left"))>g&&(t.img.css("left",g),t.options.imgEyecandy&&t.imgEyecandy.css("left",g))),t.options.onImgDrag&&t.options.onImgDrag.call(t)})}).on("mouseup",function(){i.off("mousemove")}).on("mouseout",function(){i.off("mousemove")})},rotate:function(o){var t=this;t.actualRotation+=o,t.img.css({"-webkit-transform":"rotate("+t.actualRotation+"deg)","-moz-transform":"rotate("+t.actualRotation+"deg)",transform:"rotate("+t.actualRotation+"deg)"}),t.options.imgEyecandy&&t.imgEyecandy.css({"-webkit-transform":"rotate("+t.actualRotation+"deg)","-moz-transform":"rotate("+t.actualRotation+"deg)",transform:"rotate("+t.actualRotation+"deg)"}),"function"==typeof t.options.onImgRotate&&t.options.onImgRotate.call(t)},zoom:function(o){var t=this,e=t.imgW/t.imgH,i=t.imgW,n=t.imgH,r=t.imgW+o,a=Math.floor(r/e),p=!0,l=!1,s=!1,c=function(){r-t.objW<a-t.objH?(r=t.objW,a=r/e,s=!0):(a=t.objH,r=e*a,l=!0)},d=function(){(r<t.objW||a<t.objH)&&(c(),p=!1)};d(),d();var m=function(){(r>t.imgInitW||a>t.imgInitH)&&(t.imgInitW<t.objW||t.imgInitW<t.objH?c():(r=t.imgInitW,a=t.imgInitH,p=!1))};if(t.options.allowUpscaleBeyondCropSize||(m(),m()),t.imgW=r,t.img.width(r),t.imgH=a,t.img.height(a),r!=i||a!=n){var g=t.img.css("top"),u=t.img.css("left");g="auto"==g?"0":g,u="auto"==u?"0":u;var f=parseInt(g)-o/2,h=parseInt(u)-o/2;f>0&&(f=0,l=!0),h>0&&(h=0,s=!0);var I=-(a-t.objH);I>f&&(f=I,l=!0);var v=-(r-t.objW);v>h&&(h=v,s=!0);var y=function(o){p?o.css({top:f,left:h}):(l&&o.css({top:f}),s&&o.css({left:h}))};y(t.img),t.options.imgEyecandy&&(t.imgEyecandy.width(r),t.imgEyecandy.height(a),y(t.imgEyecandy))}t.options.onImgZoom&&t.options.onImgZoom.call(t)},crop:function(){var o=this;o.options.onBeforeImgCrop&&o.options.onBeforeImgCrop.call(o),o.cropControlsCrop.hide();var i=Math.abs(parseInt(o.img.css("top"))),n=Math.abs(parseInt(o.img.css("left"))),r=function(r){o.showLoader();var a={imgUrl:o.imgUrl,imgInitW:o.imgInitW,imgInitH:o.imgInitH,imgW:o.imgW,imgH:o.imgH,imgY1:i,imgX1:n,cropH:o.objH,cropW:o.objW,rotation:o.actualRotation};r&&(a.croppedImage=r,a.imgUrl="");var p,l;if("undefined"==typeof FormData){var s=new XMLHttpRequest,c="",d=[];for(l in a)d.push(encodeURIComponent(l)+"="+encodeURIComponent(a[l]));for(l in o.options.cropData)d.push(encodeURIComponent(l)+"="+encodeURIComponent(o.options.cropData[l]));c=d.join("&").replace(/%20/g,"+"),o.options.onError&&(s.addEventListener?s.addEventListener("error",function(t){o.options.onError.call(o,"XHR Request failed")}):s.attachEvent("onerror",function(t){o.options.onError.call(o,"XHR Request failed")})),s.onreadystatechange=function(){4==s.readyState&&200==s.status&&o.afterCrop(s.responseText)},s.open("POST",o.options.cropUrl),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.setRequestHeader("Content-Length",c.length),s.send(c)}else{p=new FormData;for(l in a)a.hasOwnProperty(l)&&p.append(l,a[l]);for(l in o.options.cropData)o.options.cropData.hasOwnProperty(l)&&p.append(l,o.options.cropData[l]);e.ajax({url:o.options.cropUrl,data:p,context:t.body,cache:!1,contentType:!1,processData:!1,type:"POST"}).always(function(t){o.afterCrop(t)})}};if(o.options.processInline&&Croppic.isCanvasSupported){var a=t.createElement("canvas"),p=a.getContext("2d"),l=o.imgInitH/o.imgH,s=Math.floor(o.objH*l),c=Math.floor(o.objW*l),d=Math.floor(n*l),m=Math.floor(i*l);if(void 0===canvasResize)a.width=o.objW,a.height=o.objH,p.drawImage(o.img[0],d,m,c,s,0,0,o.objW,o.objH),r(a.toDataURL("image/"+o.options.generatedImageFormat),o.options.generatedImageQuality/100);else{var g=t.createElement("canvas");g.width=c,g.height=s,g.getContext("2d").drawImage(o.img[0],d,m,c,s,0,0,c,s),a.width=o.objW,a.height=o.objH,o.showLoader(),canvasResize(g,a,function(){o.hideLoader(),r(a.toDataURL("image/"+o.options.generatedImageFormat),o.options.generatedImageQuality/100)})}}else r()},afterCrop:function(o){var t,i=this;try{t=e.parseJSON(o)}catch(n){t="object"==typeof o?o:e.parseJSON(o)}i.originalImage=i.imgUrl,"success"==t.status&&(i.options.imgEyecandy&&i.imgEyecandy.hide(),i.destroy(),i.obj.append('<img id="croppedImg" class="croppedImg" src="'+t.url+'">'),""!==i.options.outputUrlId&&e("#"+i.options.outputUrlId).val(t.url),i.croppedImg=i.obj.find(".croppedImg"),i.options.loadPicture="",i.init(),i.hideLoader()),"error"==t.status&&(i.options.onError&&i.options.onError.call(i,t.message),i.hideLoader(),setTimeout(function(){i.reset()},2e3)),i.options.onAfterImgCrop&&i.options.onAfterImgCrop.call(i,t)},showLoader:function(){var o=this;o.obj.append(o.options.loaderHtml),o.loader=o.obj.find(".loader")},hideLoader:function(){var o=this;e.isEmptyObject(o.loader)||(o.loader.remove(),o.loader={})},reset:function(){var o=this;"function"==typeof o.options.onBeforeReset&&o.options.onBeforeReset.call(o),o.destroy(),o.init(),e.isEmptyObject(o.croppedImg)||(o.obj.append(o.croppedImg),""!==o.options.outputUrlId&&e("#"+o.options.outputUrlId).val(o.croppedImg.attr("url"))),"function"==typeof o.options.onReset&&o.options.onReset.call(o)},destroy:function(){var o=this;o.options.modal&&!e.isEmptyObject(o.modal)&&o.destroyModal(),o.options.imgEyecandy&&!e.isEmptyObject(o.imgEyecandy)&&o.destroyEyecandy(),o.options.imgOverlay&&!e.isEmptyObject(o.imgOverlay)&&o.destroyOverlay(),e.isEmptyObject(o.cropControlsUpload)||(o.cropControlsUpload.remove(),o.cropControlsUpload={}),e.isEmptyObject(o.cropControlsCrop)||(o.cropControlsCrop.remove(),o.cropControlsCrop={}),e.isEmptyObject(o.loader)||o.loader.remove(),e.isEmptyObject(o.form)||o.options.inForm||(o.form.remove(),o.form={}),e.isEmptyObject(o.croppedImg)||(o.croppedImg.remove(),o.croppedImg={}),o.obj.html("")},CreateFallbackIframe:function(){var o=this;if(Croppic.isAjaxUploadSupported)return"";var i;e.isEmptyObject(o.iframeobj)?(i=t.createElement("iframe"),i.setAttribute("id",o.id+"_upload_iframe"),i.setAttribute("name",o.id+"_upload_iframe"),i.setAttribute("width","0"),i.setAttribute("height","0"),i.setAttribute("border","0"),i.setAttribute("src","javascript:false;"),i.style.display="none",t.body.appendChild(i)):i=o.iframeobj[0];var n="#"+o.fileField[0].id,r='<!DOCTYPE html><html><head><title>Uploading File</title></head><body><form class="'+o.id+'_upload_iframe_form" name="'+o.id+'_upload_iframe_form" action="'+o.options.uploadUrl+'" method="post" enctype="multipart/form-data" encoding="multipart/form-data" style="display:none;">'+o.fileField[0].outerHTML+'<input type="hidden" name="fallbackIframe" value="1">';for(var a in o.options.uploadData)o.options.uploadData.hasOwnProperty(a)&&(r+='<input type="hidden" name="'+a+'" value="'+o.options.uploadData[a]+'">');r+="</form></body></html>",i.contentWindow.document.open("text/htmlreplace"),i.contentWindow.document.write(r),i.contentWindow.document.close(),o.iframeobj=e("#"+o.id+"_upload_iframe"),o.iframeform=o.iframeobj.contents().find("html").find("."+o.id+"_upload_iframe_form"),o.iframeFileInput=o.iframeform.find(n);var p=o.iframeFileInput[0];p.attachEvent?p.attachEvent("onchange",function(){o.SubmitFallbackIframe(o)}):p.addEventListener("onchange",function(){o.SubmitFallbackIframe(o)});var l=function(){i.detachEvent?i.detachEvent("onload",l):i.removeEventListener("load",l,!1);var t=o.getIframeContentJSON(i);e.isEmptyObject(o.modal)&&o.afterUpload(t)};return i.attachEvent?i.attachEvent("onload",l):i.addEventListener("load",l,!0),"#"+o.fileField[0].id},SubmitFallbackIframe:function(o){o.isFileValid(o.iframeFileInput[0])&&(o.showLoader(),o.options.processInline&&!o.options.uploadUrl?o.options.onError&&(o.options.onError.call(o,"processInline is not supported by your browser "),o.hideLoader()):(o.options.onBeforeImgUpload&&o.options.onBeforeImgUpload.call(o),o.iframeform[0].submit()))},getIframeContentJSON:function(o){var t;try{var i=o.contentDocument?o.contentDocument:o.contentWindow.document,n=i.body.innerHTML;"<pre>"==n.slice(0,5).toLowerCase()&&"</pre>"==n.slice(-6).toLowerCase()&&(n=i.body.firstChild.firstChild.nodeValue),t=e.parseJSON(n)}catch(r){t={success:!1}}return t},loadPicture:function(o){var t=this;t.options.loadPicture=o,t.destroy(),t.init()}};var i=t.createElement("canvas");Croppic.isCanvasSupported=i&&i.getContext&&i.getContext("2d");var n=t.createElement("input");n.type="file",Croppic.isAjaxUploadSupported="multiple"in n&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&"undefined"!=typeof(new XMLHttpRequest).upload,Croppic.isProcessInlineSupported="undefined"!=typeof FileReader}(window,document,jQuery);